<!--
Mini Change Log:
v0.6 – Section 3 renamed to "Milestone Status"; status is now a dropdown (On Track/Delayed/Not started);
       removed comments column; added "Add to status report" checkbox (default yes);
       milestones auto-strikethrough when completed; sections 4 & 5 placed side-by-side.
v0.5 – Reworked 2.1 table into Current/Previous groups with 3 columns each (Green/Amber/Red); radios aligned to headers.
v0.4 – Copy Current → Previous; 2.6 above table; coloured subcolumns; smaller radios; prompt comments when Current ≠ Green.
v0.3 – Swapped 1.6 Phase ahead of Reporting Period; removed 1.8 Version Number from UI (hidden, import tolerant).
v0.2 – White theme UI matching screenshot; CSV exports; print-friendly report.
v0.1 – Initial functional build.
-->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Status Report Generator — v0.6</title>
  <style>
    :root{
      --bg:#ffffff; --card:#ffffff; --border:#e5e7eb;
      --text:#111827; --text-dim:#4b5563;
      --g:#10b981; --a:#f59e0b; --r:#ef4444; --b:#2563eb;
      --g-tint: rgba(16,185,129,.06);
      --a-tint: rgba(245,158,11,.08);
      --r-tint: rgba(239,68,68,.06);
      --shadow: 0 6px 24px rgba(0,0,0,.08), 0 2px 8px rgba(0,0,0,.06);
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif;line-height:1.45}
    h1,h2,h3{margin:0 0 .5rem}
    h2{font-size:1.1rem;font-weight:700}
    h3{font-size:1rem;color:var(--text-dim);font-weight:600}
    .container{max-width:1200px;margin:0 auto;padding:24px}
    .grid{display:grid;gap:16px}
    .cols-2{grid-template-columns:1fr 1fr}
    .cols-2-slim{grid-template-columns:1fr 1fr}
    .card{background:var(--card);border:1px solid var(--border);border-radius:16px;box-shadow:var(--shadow);padding:16px;margin-bottom:12px}
    .toolbar{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
    .toolbar .spacer{flex:1}
    .field{display:flex;flex-direction:column;gap:6px}
    label{font-size:.85rem;color:var(--text-dim)}
    input[type="text"],input[type="date"],input[type="number"],select,textarea{
      width:100%;border:1px solid var(--border);background:#fff;color:var(--text);padding:10px 12px;border-radius:10px;outline:none
    }
    textarea{min-height:140px}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .btn{background:#fff;border:1px solid var(--border);color:var(--text);padding:10px 14px;border-radius:12px;cursor:pointer}
    .btn:hover{filter:brightness(1.03)}
    .btn.primary{background:linear-gradient(180deg,rgba(16,185,129,.12),rgba(16,185,129,.05));border-color:#1f4f2e}
    .checkbox{display:inline-flex;align-items:center;gap:8px}

    /* Tables */
    table{width:100%;border-collapse:separate;border-spacing:0 8px}
    th,td{padding:10px 12px;background:#fff;border-top:1px solid var(--border);border-bottom:1px solid var(--border);vertical-align:middle}
    th:first-child,td:first-child{border-left:1px solid var(--border);border-top-left-radius:10px;border-bottom-left-radius:10px}
    th:last-child,td:last-child{border-right:1px solid var(--border);border-top-right-radius:10px;border-bottom-right-radius:10px}
    th{font-weight:600;color:#394150}
    .center{text-align:center}

    /* 2.1 table colours via colgroup */
    col.col-g{background:var(--g-tint)}
    col.col-a{background:var(--a-tint)}
    col.col-r{background:var(--r-tint)}
    .status-radio{width:18px;height:18px;transform:scale(.95);cursor:pointer}
    .needs-comment{outline:2px dashed var(--r); outline-offset:2px; background:rgba(239,68,68,.05)}
    .hint{font-size:.85rem;color:#6b7280}

    /* Print */
    @media print{
      .no-print{display:none !important}
      .report{box-shadow:none;border:none}
      th,td{background:#fff;border-color:#ddd}
    }
    .report{background:#fff;border:1px solid #e5e7eb;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.08);padding:20px}
    .status-chip{display:inline-flex;align-items:center;gap:8px;border:1px solid #e5e7eb;border-radius:999px;padding:6px 10px}
    .strike{ text-decoration: line-through; color:#6b7280}
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="toolbar">
        <h1>Project Status Report — Builder</h1>
        <div class="spacer"></div>
        <small class="hint">v0.6</small>
      </div>
      <div class="toolbar no-print" style="margin-top:8px">
        <button class="btn" id="newBtn">New</button>
        <input class="btn" type="file" id="importFile" accept="application/json,text/json" />
        <button class="btn" id="saveJsonBtn">Save JSON</button>
        <button class="btn" id="exportCsvBtn">Export CSV (Summary)</button>
        <div class="spacer"></div>
        <button class="btn" id="printBtn">Print Report</button>
      </div>
    </div>

    <!-- 1. Base Project Information -->
    <div class="card">
      <h2>1. Base Project Information</h2>
      <div class="grid cols-2">
        <div class="field"><label>1.1 Project Name</label><input id="projName" type="text" /></div>
        <div class="field"><label>1.2 Project ID / Code</label><input id="projCode" type="text" /></div>
        <div class="field"><label>1.3 Sponsor</label><input id="sponsor" type="text" /></div>
        <div class="field"><label>1.4 Project Manager</label><input id="pm" type="text" /></div>
        <div class="field"><label>1.5 Report Date</label><input id="reportDate" type="date" /></div>
        <div class="field"><label>1.6 Project Phase</label>
          <select id="phase"><option>Initiation</option><option>Planning</option><option>Execution</option><option>Closure</option></select>
        </div>
        <div class="field"><label>1.7 Reporting Period (Start)</label><input id="periodStart" type="date" /></div>
        <div class="field"><label>1.7 Reporting Period (End)</label><input id="periodEnd" type="date" /></div>
      </div>
    </div>

    <!-- 2. Status Summary -->
    <div class="card">
      <div class="row" style="justify-content:space-between;align-items:center">
        <h2>2. Status Summary</h2>
        <div class="row no-print">
          <button class="btn" id="copyCurrentToPrev">Copy Current → Previous</button>
        </div>
      </div>

      <!-- 2.6 above table -->
      <div class="field" style="margin:10px 0">
        <label>2.6 Status summary</label>
        <textarea id="execSummary" placeholder="2–3 sentences on outcomes, variances, and asks."></textarea>
      </div>

      <table id="statusTable">
        <colgroup>
          <col class="col-item">
          <col class="col-g"><col class="col-a"><col class="col-r">
          <col class="col-g"><col class="col-a"><col class="col-r">
          <col class="col-cmt">
        </colgroup>
        <thead>
          <tr>
            <th rowspan="2">Item</th>
            <th colspan="3">Current</th>
            <th colspan="3">Previous</th>
            <th rowspan="2">Path to green / comments</th>
          </tr>
          <tr>
            <th>Green</th><th>Amber</th><th>Red</th>
            <th>Green</th><th>Amber</th><th>Red</th>
          </tr>
        </thead>
        <tbody id="statusTableBody"></tbody>
      </table>
      <div class="hint" style="margin-top:6px">If Current is Amber/Red, a short “path to green” is required.</div>
    </div>

    <!-- 3. Milestone Status -->
    <div class="card">
      <div class="row" style="justify-content:space-between;align-items:center">
        <h2>3. Milestone Status</h2>
        <button class="btn" id="addMilestone">Add Milestone</button>
      </div>
      <table>
        <thead>
          <tr>
            <th>Milestone</th>
            <th>Original Date</th>
            <th>Revised Date</th>
            <th>Status</th> <!-- Dropdown -->
            <th class="center">Add to report</th>
            <th class="no-print">Actions</th>
          </tr>
        </thead>
        <tbody id="milestoneBody"></tbody>
      </table>
      <div class="hint" style="margin-top:6px">“Completed” is inferred when the date is in the past and status is <em>On Track</em>; such milestones are shown with strikethrough.</div>
    </div>

    <!-- 4 & 5 side by side -->
    <div class="card">
      <div class="grid cols-2-slim">
        <div class="field">
          <h2>4. Key Achievements This Period</h2>
          <textarea id="achText" style="min-height:180px" placeholder="Free text…"></textarea>
        </div>
        <div class="field">
          <h2>5. Key Activities Next Period</h2>
          <textarea id="nextText" style="min-height:180px" placeholder="Free text…"></textarea>
        </div>
      </div>
    </div>

    <!-- 6. Issues & Risks -->
    <div class="card">
      <h2>6. Issues & Risks Summary</h2>
      <div class="grid cols-2">
        <div>
          <h3>6.1 Top 5 Issues</h3>
          <table>
            <thead><tr><th>Issue</th><th>Impact</th><th>Owner</th><th>Status / Next Steps</th></tr></thead>
            <tbody id="issueBody"></tbody>
          </table>
        </div>
        <div>
          <h3>6.2 Top 5 Risks</h3>
          <table>
            <thead><tr><th>Risk</th><th>Likelihood</th><th>Impact</th><th>Mitigation</th></tr></thead>
            <tbody id="riskBody"></tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- 7. Decisions -->
    <div class="card">
      <div class="row" style="justify-content:space-between;align-items:center">
        <h2>7. Decisions Required</h2>
        <button class="btn" id="addDecision">Add Decision</button>
      </div>
      <table>
        <thead><tr><th>Decision</th><th>Required By</th><th>Owner</th><th>Status</th><th class="no-print">Actions</th></tr></thead>
        <tbody id="decisionBody"></tbody>
      </table>
    </div>

    <!-- 8. Budget -->
    <div class="card">
      <h2>8. Budget Summary</h2>
      <div class="grid cols-2" style="margin-top:8px">
        <div class="field"><label>8.1 Approved Budget</label><input id="budgetApproved" type="number" min="0" step="0.01" placeholder="0.00" /></div>
        <div class="field"><label>8.2 Spend to Date</label><input id="budgetSpent" type="number" min="0" step="0.01" placeholder="0.00" /></div>
        <div class="field"><label>8.3 Current ETC</label><input id="budgetEtc" type="number" min="0" step="0.01" placeholder="0.00" /></div>
        <div class="field"><label>8.4 Budget Commentary</label><textarea id="budgetNotes" style="min-height:120px"></textarea></div>
      </div>
      <div class="row" style="margin-top:8px">
        <span class="btn">Variance to Budget: <strong id="varianceText" style="margin-left:8px">$0.00</strong></span>
      </div>
    </div>

    <!-- 9. Dependencies -->
    <div class="card">
      <div class="row" style="justify-content:space-between;align-items:center">
        <h2>9. Dependencies & Constraints</h2>
        <button class="btn" id="addDep">Add Row</button>
      </div>
      <table>
        <thead><tr><th>Dependency</th><th>Impact if Delayed</th><th>Owner</th><th class="no-print">Actions</th></tr></thead>
        <tbody id="depBody"></tbody>
      </table>
    </div>

    <!-- Report Preview -->
    <div class="card">
      <div class="row" style="justify-content:space-between;align-items:center">
        <h2>Report Preview</h2>
        <div class="row no-print">
          <button class="btn" id="refreshPreview">Refresh</button>
          <button class="btn primary" id="refreshPreview2">Build/Refresh Report</button>
          <button class="btn" id="printBtn2">Print Report</button>
        </div>
      </div>
      <div id="reportPreview" class="report"></div>
    </div>
  </div>

<script>
/* ===== Utilities ===== */
const $ = (sel) => document.querySelector(sel);
const fmtCurrency = (n) => Number.isNaN(+n) ? '$0.00' :
  new Intl.NumberFormat(undefined,{style:'currency', currency:'AUD'}).format(+n);
const download = (filename, text, mime='text/plain') => {
  const a = document.createElement('a');
  a.href = URL.createObjectURL(new Blob([text], {type:mime}));
  a.download = filename; a.click(); URL.revokeObjectURL(a.href);
};

/* ===== Status rows (no Blue for status) ===== */
function statusRowDef(){
  return [
    {key:'overall', label:'2.1 Overall Status'},
    {key:'scope',   label:'2.2 Scope Status'},
    {key:'schedule',label:'2.3 Schedule Status'},
    {key:'budget',  label:'2.4 Budget Status'},
    {key:'quality', label:'2.5 Quality Status'},
    {key:'risk',    label:'2.7 Risk Status'},
    {key:'stake',   label:'2.8 Stakeholder Status'},
  ];
}

/* ===== Build Status Table: two sections (Current, Previous) with 3 cols each ===== */
function buildStatusTable(){
  const body = $('#statusTableBody');
  body.innerHTML = '';
  for(const row of statusRowDef()){
    const tr = document.createElement('tr');
    tr.innerHTML = `
